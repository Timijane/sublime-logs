<script type="module">
  import { auth, provider } from './js/firebase.js';
  import { createUserWithEmailAndPassword, signInWithPopup, updateProfile, fetchSignInMethodsForEmail } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

  // Show/Hide Passwords
  const togglePassword = document.getElementById('toggle-password');
  const toggleConfirm = document.getElementById('toggle-confirm-password');
  const passwordInput = document.getElementById('signup-password');
  const confirmInput = document.getElementById('signup-confirm-password');

  togglePassword.addEventListener('click', () => {
    passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
  });
  toggleConfirm.addEventListener('click', () => {
    confirmInput.type = confirmInput.type === 'password' ? 'text' : 'password';
  });

  // Email/Password Sign Up
  const signupForm = document.getElementById('signup-form');
  signupForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('signup-name').value;
    const email = document.getElementById('signup-email').value;
    const password = passwordInput.value;
    const confirm = confirmInput.value;

    if (password !== confirm) {
      alert("Passwords do not match!");
      return;
    }

    try {
      // Check if email already exists
      const methods = await fetchSignInMethodsForEmail(auth, email);
      if (methods.length > 0) {
        alert("An account with this email already exists. Please login.");
        return;
      }

      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      await updateProfile(userCredential.user, { displayName: name });
      alert(`Account created successfully! Welcome ${name}`);
      window.location.href = "dashboard.html";
    } catch (error) {
      alert(error.message);
    }
  });

  // Google Sign Up (auto-register)
  const googleBtn = document.getElementById('google-signup');
  googleBtn.addEventListener('click', async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      alert(`Welcome ${result.user.displayName}`);
      window.location.href = "dashboard.html";
    } catch (error) {
      alert(error.message);
    }
  });
</script>

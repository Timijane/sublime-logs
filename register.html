<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sublime Logs - Sign Up</title>
<link href="https://fonts.googleapis.com/css2?family=Lobster&family=David+Libre&display=swap" rel="stylesheet">
<style>
  body {
    margin:0; font-family: 'David Libre', sans-serif; background:#fdf6e3; display:flex; justify-content:center; align-items:center; height:100vh;
  }
  .signup-card {
    background:#fff; padding:3rem; border-radius:12px; box-shadow:0 8px 25px rgba(0,0,0,0.2); width:90%; max-width:400px; text-align:center;
  }
  .signup-card h2 {
    font-family:'Lobster', cursive; font-size:2.5rem; margin-bottom:1rem; color:#8e2de2;
  }
  .signup-card p {
    margin-bottom:2rem; font-size:1rem; color:#555;
  }
  .signup-card input {
    width:100%; padding:0.8rem; margin-bottom:1rem; border-radius:8px; border:1px solid #ccc; font-size:1rem;
  }
  .signup-card button {
    width:100%; padding:0.8rem; background:linear-gradient(45deg,#8e2de2,#c94bff); border:none; color:#fff; font-size:1.1rem; border-radius:8px; cursor:pointer;
    transition:0.3s;
  }
  .signup-card button:hover { opacity:0.9; }
  .google-btn {
    margin-top:1rem; background:#fff; color:#555; border:1px solid #ccc; display:flex; align-items:center; justify-content:center;
  }
  .google-btn img { width:20px; margin-right:8px; }
  .error-msg { color:red; margin-bottom:1rem; }
  .login-link { margin-top:1rem; font-size:0.95rem; color:#555; }
  .login-link a { color:#8e2de2; text-decoration:none; }
</style>
</head>
<body>

<div class="signup-card">
  <h2>Sign Up</h2>
  <p>Create your account with Sublime Logs</p>
  
  <div class="error-msg" id="error-msg"></div>
  
  <input type="text" id="name" placeholder="Full Name" required>
  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  
  <button id="signup-btn">Sign Up</button>
  
  <button class="google-btn" id="google-btn">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/512px-Google_%22G%22_Logo.svg.png" alt="Google Logo">
    Sign Up with Google
  </button>
  
  <div class="login-link">Already have an account? <a href="login.html">Login</a></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBxZVYRQ7xqy0qe8utXlvO9UpVDbH7dM1I",
    authDomain: "sublime-blog.firebaseapp.com",
    projectId: "sublime-blog",
    storageBucket: "sublime-blog.firebasestorage.app",
    messagingSenderId: "642663556339",
    appId: "1:642663556339:web:cfa7891d6c139ffbdc4386",
    measurementId: "G-7NFT0KEMDP"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  // Persistent login
  setPersistence(auth, browserLocalPersistence);

  const signupBtn = document.getElementById('signup-btn');
  const googleBtn = document.getElementById('google-btn');
  const errorMsg = document.getElementById('error-msg');

  // Email/Password Sign Up
  signupBtn.addEventListener('click', async () => {
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    if(!name || !email || !password){
      errorMsg.textContent = "All fields are required!";
      return;
    }

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // Save extra user info in Firestore
      await setDoc(doc(db, "users", user.uid), {
        name: name,
        email: email,
        profilePic: null // user can add later
      });

      // Redirect to dashboard
      window.location.href = "dashboard.html";

    } catch (error) {
      errorMsg.textContent = error.message;
    }
  });

  // Google Sign-Up/Login
  googleBtn.addEventListener('click', async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;

      // Check if user exists in Firestore
      const userRef = doc(db, "users", user.uid);
      const docSnap = await userRef.get ? await userRef.get() : null;
      if (!docSnap || !docSnap.exists()) {
        // Save new user info
        await setDoc(userRef, {
          name: user.displayName,
          email: user.email,
          profilePic: user.photoURL || null
        });
      }

      // Redirect to dashboard
      window.location.href = "dashboard.html";
    } catch (error) {
      errorMsg.textContent = error.message;
    }
  });
</script>

</body>
</html>

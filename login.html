<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sublime Blog Login</title>
<style>
  body {
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background: linear-gradient(120deg,#0f0c29,#302b63);
    color:#fff;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }
  .container {
    background: rgba(0,0,0,0.8);
    padding:2rem;
    border-radius:12px;
    width:90%;
    max-width:400px;
    text-align:center;
    box-shadow: 0 0 20px #00c6ff;
  }
  .container img { width:80px; margin-bottom:1rem; }
  h2 { margin-bottom:1rem; color:#00c6ff; }
  input {
    width:100%; padding:0.75rem; margin:0.5rem 0;
    border-radius:6px; border:none;
  }
  button {
    width:100%; padding:0.75rem; margin:0.5rem 0;
    border:none; border-radius:6px;
    background:#00c6ff; color:#000; font-weight:bold; cursor:pointer;
  }
  button:hover { background:#009acd; color:#fff; }
  .google-btn { background:#db4437; color:#fff; margin-top:1rem; }
  a { color:#00c6ff; text-decoration:none; font-size:0.9rem; }
  a:hover { text-decoration:underline; }
  .hidden { display:none; }
</style>
</head>
<body>

<!-- Login Form -->
<div class="container login-container">
  <img src="logo.png" alt="Sublime Blog Logo">
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Login</button>
  <button class="google-btn" id="googleLoginBtn">Login with Google</button>
  <p><a href="#" id="forgotPassword">Forgot Password?</a></p>
  <p>Don't have an account? <a href="#" id="showSignUp">Create Account</a></p>
</div>

<!-- Sign Up Form -->
<div class="container signup-container hidden">
  <img src="logo.png" alt="Sublime Blog Logo">
  <h2>Create Account</h2>
  <input type="email" id="signupEmail" placeholder="Email">
  <input type="password" id="signupPassword" placeholder="Password (min 6)">
  <button id="signupBtn">Create Account</button>
  <p><a href="#" id="backToLogin">Back to Login</a></p>
</div>

<script type="module">
  import { auth, db } from './js/firebase.js';
  import { 
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    sendPasswordResetEmail,
    GoogleAuthProvider,
    signInWithPopup,
    setPersistence,
    browserLocalPersistence,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
  import { doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  document.addEventListener('DOMContentLoaded', () => {

    // Keep users logged in
    setPersistence(auth, browserLocalPersistence);

    // Auto-redirect if already logged in
    onAuthStateChanged(auth, user => {
      if(user) window.location.href = "dashboard.html";
    });

    // DOM Elements
    const loginContainer = document.querySelector('.login-container');
    const signupContainer = document.querySelector('.signup-container');

    // Toggle Sign Up Form
    document.getElementById('showSignUp').addEventListener('click', () => {
      loginContainer.classList.add('hidden');
      signupContainer.classList.remove('hidden');
    });

    // Back to Login
    document.getElementById('backToLogin').addEventListener('click', () => {
      signupContainer.classList.add('hidden');
      loginContainer.classList.remove('hidden');
    });

    // Login
    document.getElementById('loginBtn').addEventListener('click', async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      if(!email || !password){ alert("Enter email and password"); return; }
      try{
        await signInWithEmailAndPassword(auth, email, password);
        window.location.href = "dashboard.html";
      }catch(err){
        alert("Login Error: " + err.message);
      }
    });

    // Google Login
    const provider = new GoogleAuthProvider();
    document.getElementById('googleLoginBtn').addEventListener('click', async () => {
      try{
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        await setDoc(doc(db, "wallets", user.uid), { balance: 0 }, { merge:true });
        window.location.href = "dashboard.html";
      }catch(err){
        alert("Google Login Error: " + err.message);
      }
    });

    // Sign Up
    document.getElementById('signupBtn').addEventListener('click', async () => {
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      if(!email || !password){ alert("Email and password required"); return; }

      try{
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await setDoc(doc(db, "wallets", user.uid), { balance: 0 });
        alert("Account created! Logging in...");
        window.location.href = "dashboard.html";
      }catch(err){
        alert("Sign Up Error: " + err.message);
      }
    });

    // Forgot Password
    document.getElementById('forgotPassword').addEventListener('click', async () => {
      const email = prompt("Enter your email to reset password:");
      if(!email) return;
      try{
        await sendPasswordResetEmail(auth, email);
        alert("Password reset email sent!");
      }catch(err){
        alert("Reset Error: " + err.message);
      }
    });

  });
</script>

</body>
</html>

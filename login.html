<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sublime Blog - Login</title>
<link rel="stylesheet" href="css/style.css">
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#0f0c29,#302b63,#24243e);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  .login-container {
    background: rgba(0,0,0,0.75);
    padding: 2rem;
    border-radius: 15px;
    width: 350px;
    box-shadow: 0 0 20px #00c6ff;
    text-align: center;
  }
  .login-container h2 {
    margin-bottom: 1.5rem;
    font-weight: bold;
    color: #00c6ff;
    letter-spacing: 1px;
  }
  input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
  }
  button {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  .login-btn { background: #00c6ff; color: #000; }
  .login-btn:hover { background: #009acd; color: #fff; }
  .google-btn { background: #db4437; color: #fff; }
  .google-btn:hover { background: #c23321; }
  .forgot { font-size: 0.85rem; }
  a { color: #00c6ff; text-decoration: none; }
  a:hover { text-decoration: underline; }
</style>
</head>
<body>

<div class="login-container">
  <h2>Sublime Blog</h2>
  <p style="font-style: italic; color:#ccc;">Number Verification & Gift Sending Service</p>

  <!-- Email/Password Form -->
  <form id="loginForm">
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit" class="login-btn">Login</button>
    <p class="forgot"><a href="#" id="resetLink">Forgot Password?</a></p>
  </form>

  <hr style="border-color: #00c6ff; margin:20px 0;">

  <!-- Google Login -->
  <button id="googleLogin" class="google-btn">Sign in with Google</button>
</div>

<script type="module">
import { auth, provider } from './js/firebase.js';
import { 
  signInWithPopup, signInWithEmailAndPassword, 
  sendPasswordResetEmail, linkWithPopup, linkWithCredential, GoogleAuthProvider, EmailAuthProvider 
} from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

// Email/Password Login
document.getElementById('loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Optional: check email verification
    if(!user.emailVerified){
      alert("Please verify your email before logging in.");
      return;
    }

    // Link Google automatically if user wants
    const googleLogin = confirm("Do you want to link your Google account to this login?");
    if(googleLogin){
      try {
        await linkWithPopup(user, provider);
        alert("Google account linked successfully!");
      } catch(err){
        if(err.code === 'auth/credential-already-in-use'){
          alert("This Google account is already linked to another user.");
        } else {
          alert(err.message);
        }
      }
    }

    alert("Logged in as " + user.email);
    window.location.href = "dashboard.html";

  } catch(err) {
    alert(err.message);
  }
});

// Google Login
document.getElementById('googleLogin').addEventListener('click', async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    // Optional: ask to link Email/Password
    const linkEmail = confirm("Do you want to link an Email/Password to this account?");
    if(linkEmail){
      const email = prompt("Enter email to link:");
      const password = prompt("Enter password:");
      if(email && password){
        const credential = EmailAuthProvider.credential(email, password);
        try{
          await linkWithCredential(user, credential);
          alert("Email/Password linked successfully!");
        } catch(err){
          alert(err.message);
        }
      }
    }

    alert("Google login successful: " + user.displayName);
    window.location.href = "dashboard.html";
  } catch(err){
    alert(err.message);
  }
});

// Password Reset
document.getElementById('resetLink').addEventListener('click', async e => {
  e.preventDefault();
  const email = prompt("Enter your email for password reset:");
  if(email){
    try{
      await sendPasswordResetEmail(auth, email);
      alert("Password reset email sent!");
    } catch(err){
      alert(err.message);
    }
  }
});
</script>

</body>
</html>

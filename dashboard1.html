<!-- dashboard1.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
<h1>Welcome to your Dashboard</h1>
<p>Your balance: <span id="balance">Loading...</span></p>
<button id="addFundsBtn">Add $100</button>
<button id="logoutBtn">Logout</button>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDVu5IQ3Y5bvgAfSKym8kXPpZZWKqMELTM",
    authDomain: "sublime-logs.firebaseapp.com",
    projectId: "sublime-logs",
    storageBucket: "sublime-logs.firebasestorage.app",
    messagingSenderId: "381847722551",
    appId: "1:381847722551:web:8ec68f018291d3927f3db2",
    measurementId: "G-8YHHJC1MP7"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Ensure user is logged in
  auth.onAuthStateChanged(async user => {
    if (!user) {
      window.location = 'login.html'; // redirect if not logged in
      return;
    }

    const uid = user.uid;

    // Auto-create wallet document if not exists
    const walletRef = db.collection('wallets').doc(uid);
    const walletDoc = await walletRef.get();
    if (!walletDoc.exists) {
      await walletRef.set({ balance: 0 });
      console.log("Wallet created automatically!");
    }

    // Show current balance
    const snapshot = await walletRef.get();
    document.getElementById('balance').innerText = snapshot.data().balance;

    // Add funds button
    document.getElementById('addFundsBtn').addEventListener('click', async () => {
      const current = (await walletRef.get()).data().balance;
      const newBalance = current + 100;
      await walletRef.update({ balance: newBalance });

      // Log transaction automatically
      await db.collection('transactions').add({
        uid: uid,
        amount: 100,
        type: 'Deposit',
        date: firebase.firestore.Timestamp.now()
      });

      document.getElementById('balance').innerText = newBalance;
      alert("Added $100 successfully!");
    });

    // Logout button
    document.getElementById('logoutBtn').addEventListener('click', () => {
      auth.signOut().then(() => window.location = 'login.html');
    });
  });
</script>
</body>
</html>
